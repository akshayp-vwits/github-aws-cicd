version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 12
  pre_build:
    commands:
      - echo Entered Deploy Stage
      - echo installing npm
      - npm install
      - npm install -g aws-cdk
      - npm install -g cdk-assume-role-credential-plugin
  build:
    commands:
      - cd ./artifacts/${ENV_NAME}
      - ls
      - cdk deploy --app './cdk.out/' --plugin cdk-assume-role-credential-plugin -v --context assume-role-credentials:writeIamRoleName=cdk-writeRole --context assume-role-credentials:readIamRoleName=cdk-readOnlyRole --parameters uploadBucketName=fx-development-all-infrastructure-cdk

